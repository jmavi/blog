<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Paparazzi UAV 通信协议 | 南京惊鸣航空科技有限公司博客专栏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="PPRZ： 报文格式：PPRZ-message: ABCxxxxxxxDE    A PPRZ_STX (0x99) //A位置，报文帧头    B LENGTH (A-&amp;gt;E)   //B位置，报文长度，涵盖了从A-&amp;gt;E区的总长度！    C PPRZ_DATA      0 SENDER_ID      1 MSG_ID      2 MSG_PAYLOAD      . DATA">
<meta property="og:type" content="article">
<meta property="og:title" content="Paparazzi UAV 通信协议">
<meta property="og:url" content="https://jmavi.github.io/blog/2016/07/12/protocol/index.html">
<meta property="og:site_name" content="南京惊鸣航空科技有限公司博客专栏">
<meta property="og:description" content="PPRZ： 报文格式：PPRZ-message: ABCxxxxxxxDE    A PPRZ_STX (0x99) //A位置，报文帧头    B LENGTH (A-&amp;gt;E)   //B位置，报文长度，涵盖了从A-&amp;gt;E区的总长度！    C PPRZ_DATA      0 SENDER_ID      1 MSG_ID      2 MSG_PAYLOAD      . DATA">
<meta property="og:updated_time" content="2016-07-12T13:47:44.345Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Paparazzi UAV 通信协议">
<meta name="twitter:description" content="PPRZ： 报文格式：PPRZ-message: ABCxxxxxxxDE    A PPRZ_STX (0x99) //A位置，报文帧头    B LENGTH (A-&amp;gt;E)   //B位置，报文长度，涵盖了从A-&amp;gt;E区的总长度！    C PPRZ_DATA      0 SENDER_ID      1 MSG_ID      2 MSG_PAYLOAD      . DATA">
  
    <link rel="alternate" href="/atom.xml" title="南京惊鸣航空科技有限公司博客专栏" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/blog/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">南京惊鸣航空科技有限公司博客专栏</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">Nanjing JingMing Aviation Technology Co. Ltd</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://jmavi.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-protocol" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/07/12/protocol/" class="article-date">
  <time datetime="2016-07-12T13:37:10.130Z" itemprop="datePublished">2016-07-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Paparazzi UAV 通信协议
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>PPRZ：<br> 报文格式：<br>PPRZ-message: ABCxxxxxxxDE<br>    A PPRZ_STX (0x99) //A位置，报文帧头<br>    B LENGTH (A-&gt;E)   //B位置，报文长度，涵盖了从A-&gt;E区的总长度！<br>    C PPRZ_DATA<br>      0 SENDER_ID<br>      1 MSG_ID<br>      2 MSG_PAYLOAD<br>      . DATA (messages.xml)<br>    D PPRZ_CHECKSUM_A (sum[B-&gt;C])<br>    E PPRZ_CHECKSUM_B (sum[ck_a])</p>
<p>PPRZ是PPZ官方标准的传输协议，其实包含一个所有协议通用的接口，也即struct transport trans;，然后才是PPRZ私有的数据内容：<br>struct pprz_transport {<br>  // generic interface<br>  struct transport trans;<br>  // specific pprz transport variables<br>  uint8_t status;<br>  uint8_t payload_idx;<br>  uint8_t ck_a, ck_b;<br>}; </p>
<p>其中，通用接口里有了：</p>
<p>下面以一串报文为例讲解：<br>992AA2 C6 00 00 00 00 00 00 00 00 6C 03 00 00 00 00 00 00 00 00 00 00 D8 3D 00 00 20 00 00 00 05 00 00 00 BD FF FF FFF5DA<br>A位置：99代表帧头标记位，B位置：2A代表长度=42个字节（代表报文的总长度）可以掰手指数，确实是42个字节，接着，A2是sender_id，也就是发送数据者的ID，我们看到是A2=162，接下来是message_id，C6=198，这些ID从include\messages.h内查看得到。例如198对应的消息是：#define DL_INS 198，那么，现在我们来看看INS是啥玩意了：找到messages.xml配置文件，找到INS对应位置是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;message name=&quot;INS&quot; id=&quot;198&quot;&gt;</span><br><span class="line">  &lt;field name=&quot;ins_x&quot;     type=&quot;int32&quot; alt_unit=&quot;m&quot;    alt_unit_coef=&quot;0.0039063&quot;/&gt;</span><br><span class="line">  &lt;field name=&quot;ins_y&quot;     type=&quot;int32&quot; alt_unit=&quot;m&quot;    alt_unit_coef=&quot;0.0039063&quot;/&gt;</span><br><span class="line">  &lt;field name=&quot;ins_z&quot;     type=&quot;int32&quot; alt_unit=&quot;m&quot;    alt_unit_coef=&quot;0.0039063&quot;/&gt;</span><br><span class="line">  &lt;field name=&quot;ins_xd&quot;    type=&quot;int32&quot; alt_unit=&quot;m/s&quot;  alt_unit_coef=&quot;0.0000019&quot;/&gt;</span><br><span class="line">  &lt;field name=&quot;ins_yd&quot;    type=&quot;int32&quot; alt_unit=&quot;m/s&quot;  alt_unit_coef=&quot;0.0000019&quot;/&gt;</span><br><span class="line">  &lt;field name=&quot;ins_zd&quot;    type=&quot;int32&quot; alt_unit=&quot;m/s&quot;  alt_unit_coef=&quot;0.0000019&quot;/&gt;</span><br><span class="line">  &lt;field name=&quot;ins_xdd&quot;   type=&quot;int32&quot; alt_unit=&quot;m/s2&quot; alt_unit_coef=&quot;0.0009766&quot;/&gt;</span><br><span class="line">  &lt;field name=&quot;ins_ydd&quot;   type=&quot;int32&quot; alt_unit=&quot;m/s2&quot; alt_unit_coef=&quot;0.0009766&quot;/&gt;</span><br><span class="line">  &lt;field name=&quot;ins_zdd&quot;   type=&quot;int32&quot; alt_unit=&quot;m/s2&quot; alt_unit_coef=&quot;0.0009766&quot;/&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure></p>
<p>现在，我们看到INS包含了9个变量，每个变量用int32存储，也就是每个变量占4个字节，合计36个字节，用下划线表示了payload具体数值。<br>D位置内容：F5=245，这个是PPRZ_CHECKSUM_A (sum[B-&gt;C])<br>E位置内容：DA=218，这个是PPRZ_CHECKSUM_B (sum[ck_a])</p>
<p>下面再提供2串PPRZ报文，感兴趣的可以自己动手解析看看哦：<br>99 40 A2 93 00 00 00 00 00 00 00 00 7F FC FF FF 00 00 00 00 00 00 00 00 71 15 00 00 7C FF FF FF 30 FF FF FF F3 09 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 16 86</p>
<p>99 26 A2 9A 8C 21 95 1B FA 97 B6 00 10 12 11 1A 69 5B F7 19 84 06 E2 00 BA 08 03 00 38 3E 02 00 80 02 C3 47 5C 7C 99 40 A2 93 00 00 00 00 00 00 00 00 69 FC FF FF 00 00 00 00 00 00 00 00 93 D3 FE FF 7C FF FF FF 31 FF FF FF F4 09 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 DF 89</p>
<p>QQ交流群：34528825</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jmavi.github.io/blog/blog/2016/07/12/protocol/" data-id="ciqjikikw0005fcqeety1crd5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2016/07/12/photo/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Paparazzi UAV 测绘功能
        
      </div>
    </a>
  
  
    <a href="/blog/2016/06/24/short/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Paparazzi UAV 中的常见缩写</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/06/">June 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2016/07/12/photo/">Paparazzi UAV 测绘功能</a>
          </li>
        
          <li>
            <a href="/blog/2016/07/12/protocol/">Paparazzi UAV 通信协议</a>
          </li>
        
          <li>
            <a href="/blog/2016/06/24/short/">Paparazzi UAV 中的常见缩写</a>
          </li>
        
          <li>
            <a href="/blog/2016/06/21/howto/">打造自己的Paparazzi UAV ：手把手教你</a>
          </li>
        
          <li>
            <a href="/blog/2016/06/19/ppz_uav/">Paparazzi UAV 简介</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 王博士<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>

  </div>
</body>
</html>